name: Playwright Tests
on:
   push:
      branches: [main, master]
jobs:
   PlayWright_DOSP_Test:
      timeout-minutes: 60
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-node@v3
           with:
              node-version: 18
         - name: Install dependencies
           run: npm ci
         - name: Install Playwright Browsers
           run: npx playwright install --with-deps
         - name: Run Playwright tests
           env:
              URL: ${{ secrets.URL }}
              USERNAME: ${{ secrets.USERNAME }}
              PASSWORD: ${{ secrets.PASSWORD }}
           run: npm run test:ci
         - uses: actions/upload-artifact@v3
           if: always()
           with:
              name: playwright-report
              path: playwright-report/
              retention-days: 90
         - name: Send mail
           if: always()
           uses: dawidd6/action-send-mail@v3
           with:
              connection_url: ${{secrets.MAIL_CONNECTION}}
              # Required mail subject:
              subject: DOSP - Playwright Automation Results
              # Required recipients' addresses:
              to: joren.janssens@ctg.com,jorenjanssens@me.com
              # Required sender full name (address can be skipped):
              from: Joren Janssens # <qualityingrained@gmail.com>
              # Optional plain body:
              body: Results of the test run can be found in the attachments.
              # Optional recipient of the email response:
              reply_to: joren.janssens@ctg.com
              # Optional attachments:
              attachments: playwright-report/*
              # Optional priority: 'high', 'normal' (default) or 'low'
              priority: low
